define(["loglevel","jquery","backbone","q","fenix-ui-catalog","fenix-ui-bridge","underscore","toastr","fenix-ui-menu","fenix-ui-metadata-editor","fenix-ui-DSDEditor","fenix-ui-DataEditor"],function(e,t,n,i,a,o,r,s,d,l,c,u){return function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={exports:{},id:i,loaded:!1};return e[i].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){var i,a;i=[n(2),n(3),n(4),n(58),n(59),n(11),n(46)],a=function(e,t,i,a,o,r,s){"use strict";function d(i){e.info("FENIX Data Management",i),t.extend(!0,this,{initial:i}),this._parseInput();var a=this._validateInput();a===!0?(e.info("DM: Config is valid"),n(60),e.info("Init Resource Manager Environment"),s.setEnvironment(this.environment),this._attach(),this._start()):(e.error("Impossible to create Data Management"),e.error(a))}return d.prototype._validateInput=function(){var t=!0,n=[];return 0===this.$el.length&&(n.push({code:r.MISSING_CONTAINER}),e.warn("Impossible to find container")),n.length>0?n:t},d.prototype._attach=function(){this.$el.html(a)},d.prototype._parseInput=function(){this.$el=t(this.initial.el),this.cache="boolean"==typeof this.initial.cache?this.initial.cache:o.cache,this.environment=this.initial.environment,this.lang=this.initial.lang||o.lang,this.config=this.initial.config||o.config,this.dsdEditor=this.initial.dsdEditor||o.dsdEditor,this.catalog=this.initial.catalog||o.catalog,this.metadataEditor=this.initial.metadataEditor||o.metadataEditor},d.prototype._start=function(){this.router=new i({$el:this.$el,cache:this.cache,environment:this.environment,lang:this.lang,dsdEditor:this.dsdEditor,catalog:this.catalog,config:this.config,metadataEditor:this.metadataEditor})},d}.apply(t,i),!(void 0!==a&&(e.exports=a))},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){var i,a;i=[n(3),n(6),n(32),n(2),n(33),n(34),n(35),n(36),n(37),n(38),n(5),n(43),n(44),n(47),n(49),n(51),n(56),n(46),n(39)],a=function(e,t,n,i,a,o,r,s,d,l,c,u,h,f,p,v,m,g,D){"use strict";var b={MENU:"#fx-data-management-menu",CONTAINER:"#fx-data-management-content",HOLDER:"#fx-data-management-content-holder",BTN_CONTAINER:"#fx-data-managment-update-model-holder",BTN_ELEMENT:"#fx-data-managment-update-button",HEADER:"#fx-data-managment-header-title",RES_TITLE:"#fx-data-managment-resource-title"};return t.Router.extend({initialize:function(n){i.info("Data Management - Router",n),e.extend(!0,this,{initial:n}),this._parseInput(),this._initCommonViews(),this._initVariables(),this._bindEventListeners(),t.history.start()},routes:r,_parseInput:function(){this.$el=this.initial.$el,this.container=this.initial.container||b.CONTAINER,this.cache=this.initial.cache,this.environment=this.initial.environment,this.lang=this.initial.lang,this.config=this.initial.config,this.dsdEditor=this.initial.dsdEditor,this.catalog=this.initial.catalog,this.metadataEditor=this.initial.metadataEditor},_initCommonViews:function(){i.info("Render common views"),a.options=o,e(this.$el.find(b.BTN_ELEMENT)).html(D[this.lang.toLowerCase()].btnSave),e(this.$el.find(b.BTN_CONTAINER)).hide(),this.initMenu()},initMenu:function(){i.info("render menu");var e=this;this.menu=new s({lang:e.lang,config:d,container:b.MENU}),this.menuInitial()},menuInitial:function(){var t=this,n=["delete","metadata","dsd","data","home","close"];e.each(n,function(e,n){t.menu.disableItem(n)}),t.menu.activateItem("add"),e(this.$el.find(b.BTN_CONTAINER)).hide()},menuActivated:function(){var t=this,n=["delete","metadata","dsd","data","home","close"];e.each(n,function(e,n){t.menu.activateItem(n)}),t.menu.disableItem("add")},_initVariables:function(){this.$viewsHolder=this.$el.find(b.HOLDER)},_bindEventListeners:function(){i.info("bindEventListeners");var e=this;this.menu.on("select",function(t){e.goTo("#/"+t.id)}),this.listenTo(t,"resource:new",function(){i.info("[EVT] resource:new ",g.resource),a.info(D[e.lang.toLowerCase()].resourceNew),e.menuActivated(),e.goTo("#/metadata")}),this.listenTo(t,"resource:deleted",function(){i.info("[EVT] resource:deleted ",g.resource),a.success(D[e.lang.toLowerCase()].resourceDeleted),e.menuInitial(),e.goTo("#/landing")}),this.listenTo(t,"resource:loading",function(e){i.info("[EVT] resource:loading ",e),g.unloadResource(),g.loadResource(e)}),this.listenTo(t,"resource:delete",function(){i.info("[EVT] resource:delete ",g.resource),g.deleteResource()}),this.listenTo(t,"resource:loaded",function(){i.info("[EVT] resource:loaded ",g.resource),e.menuActivated(),a.success(D[e.lang.toLowerCase()].resourceLoaded),e.goTo("#/home")}),this.listenTo(t,"resource:unloaded",function(){i.info("[EVT] resource:unloaded ",g.resource),e.menuInitial()}),this.listenTo(t,"resource:updated",function(){i.info("[EVT] resource:updated ",g.resource),a.success(D[e.lang.toLowerCase()].resourceSaved),e.goTo("#/home")}),this.listenTo(t,"data:loading",function(){i.info("[EVT] data:loading ")}),this.listenTo(t,"data:loaded",function(){i.info("[EVT] data:loaded ")}),this.listenTo(t,"data:saving",function(e){i.info("[EVT] data:saving"),g.setData(e)}),this.listenTo(t,"meta:loading",function(){i.info("[EVT] meta:loading")}),this.listenTo(t,"meta:saving",function(e){i.info("[EVT] meta:saving"),g.setMetadata(e)}),this.listenTo(t,"meta:loaded",function(){i.info("[EVT] meta:loaded")}),this.listenTo(t,"dsd:setcolumns",function(e){i.info("[EVT] dsd:setcolumns"),g.setDSDColumns(e)}),this.listenTo(t,"dsd:loading",function(){i.info("[EVT] dsd:loading")}),this.listenTo(t,"dsd:loaded",function(){i.info("[EVT] dsd:loaded ")}),this.listenTo(t,"error:showerrormsg",function(e){i.info("[EVT] error:showerrormsg "),a.error(e)}),this.listenTo(t,"error:showerror",function(e,t){i.info("[EVT] error:showerror ",e,t);var n=D[this.lang.toLowerCase()][e]||JSON.stringify(t)||"Generic Error";a.error(n)}),this.listenTo(t,"error:showerrorsrv",function(e,t){i.info("[EVT] error:showerrorsrv ",e,t);var n=D[this.lang.toLowerCase()][e]||JSON.stringify(t.responseText)||"Generic Error";a.error(n)}),this.listenTo(t,"button:new",function(){i.info("[EVT] button:new "),this.goTo("#/add")}),this.listenTo(t,"button:search",function(){i.info("[EVT] button:search "),this.goTo("#/search")}),this.listenTo(t,"button:undo",function(){i.info("[EVT] button:undo "),this.goTo("#/home")}),this.listenTo(t,"button:metadata",function(){i.info("[EVT] button:metadata "),this.goTo("#/metadata")}),this.listenTo(t,"button:dsd",function(){i.info("[EVT] button:dsd "),this.goTo("#/dsd")}),this.listenTo(t,"button:data",function(){i.info("[EVT] button:data "),this.goTo("#/data")})},onLanding:function(){i.info("onLanding called."),this.switchView(l,{container:this.container,menu:"landing",lang:this.lang,environment:this.environment}),this.menuInitial()},onHome:function(){i.info("onHome called."),e(this.$el.find(b.BTN_CONTAINER)).hide(),this.switchView(m,{container:this.container,menu:"home",lang:this.lang,environment:this.environment})},onSearch:function(){i.info("onSearch called."),g.unloadResource(),e(this.$el.find(b.BTN_CONTAINER)).hide(),this.switchView(c,{container:this.container,menu:"search",lang:this.lang,environment:this.environment,catalog:this.catalog})},onDenied:function(){i.info("Denied - Routing to Lading"),e(this.$el.find(b.BTN_CONTAINER)).hide(),this.goTo("#/landing")},onClose:function(){i.info("Close - Routing to Lading"),g.unloadResource(),a.success(D[this.lang.toLowerCase()].CloseHeader),this.goTo("#/landing")},onAdd:function(){i.info("Add Resource"),i.warn("Avoid to render the resource and directly cast the event"),g.newResource(this.config)},onMetadata:function(){i.info("Metadata View"),e(this.$el.find(b.BTN_CONTAINER)).show(),this.switchView(f,{container:this.container,menu:"search",lang:this.lang,environment:this.environment,config:this.metadataEditor,model:g.getMetadata(),savebtn:b.BTN_ELEMENT})},onDSD:function(){i.info("DSD View"),e(this.$el.find(b.BTN_CONTAINER)).show(),this.switchView(p,{container:this.container,menu:"dsd",lang:this.lang,environment:this.environment,config:this.dsdEditor,model:g.getDSD(),isEditable:g.isDSDEditable(),savebtn:b.BTN_ELEMENT})},onData:function(){i.info("Data View"),e(this.$el.find(b.BTN_CONTAINER)).show(),this.switchView(v,{container:this.container,menu:"data",lang:this.lang,codelists:g.getCurrentResourceCodelists(),dsd:g.getDSD(),data:g.getData(),generator:g.generateDSDStructure(),environment:this.environment,savebtn:b.BTN_ELEMENT})},onDelete:function(){i.info("Delete Resource"),e(this.$el.find(b.BTN_CONTAINER)).hide(),this.switchView(h,{container:this.container,menu:"delete",lang:this.lang,environment:this.environment})},onNotFound:function(){i.info("Not found"),e(this.$el.find(b.BTN_CONTAINER)).hide(),this.switchView(u,{container:this.container,lang:this.lang})},onDefaultRoute:function(){i.info("Default"),e(this.$el.find(b.BTN_CONTAINER)).hide(),this.goTo("#/not-found")},switchView:function(e,t){if(this.currentViewCreator===e)return void i.warn("Abort switch view because candidate view is current view");this.currentViewCreator=e,i.info("Switch view");var n=this,a=new e(t);"function"==typeof a.accessControl?(i.info("View has access control"),a.accessControl(g.resource).then(function(){i.warn("Access control: GRANTED"),n.resetView(),n.renderView(e,t)},function(){i.warn("Access control: DENIED"),n.resetView(),n.onDenied()})):(i.info("View has NOT access control"),this.resetView(),this.renderView(e,t))},resetView:function(){this.disposeCurrentView(),this.addViewContainer()},renderView:function(t,n){var i=new t(n),a="";this.currentView=i.render(n),this.menu.select(n.menu),e(this.$el.find(b.HEADER)).html(this.menu.o.active),e.isPlainObject(g.resource.metadata)&&(a=g.resource.metadata.title?" / "+g.resource.metadata.title[this.lang]:" / "+D[this.lang.toLowerCase()].NoTitle),e(this.$el.find(b.RES_TITLE)).html(a)},disposeCurrentView:function(){this.currentView&&this.currentView.remove&&(this.currentView.remove(),delete this.currentView,i.info("Removed current view")),i.info("Dispose current view: success")},addViewContainer:function(){this.$viewsHolder.html('<div id="'+b.CONTAINER.substring(1)+'"></div>'),i.info("Add view container: success")},goTo:function(e,t,n){this.navigate(e,{trigger:!!t,replace:!!n})}})}.apply(t,i),!(void 0!==a&&(e.exports=a))},function(e,t,n){var i,a;i=[n(3),n(6),n(2),n(7),n(8),n(9),n(10),n(11),n(12)],a=function(e,t,n,i,a,o,r,s,d){"use strict";var l={catalogContainer:"#catalog-container"},c=t.View.extend({render:function(t){e.extend(!0,this,{initial:t}),e.extend(!0,o,{initial:t.catalog}),this._parseInput();var i=this._validateInput();return i===!0?(n.info("Rendering View - Search",this),this.$container.html(d),this.catalog=new a(o),this._bindEventListeners(),this):(n.error("Impossible to render Search"),void n.error(i))},_validateInput:function(){var e=!0,t=[];return 0===this.$container.length&&(t.push({code:s.MISSING_CONTAINER}),n.warn("Impossible to find container")),t.length>0?t:e},_parseInput:function(){this.$container=e(this.initial.container),this.cache=this.initial.cache,this.environment=this.initial.environment,this.lang=this.initial.lang.toLowerCase(),o.el=o.initial.el||l.catalogContainer,o.lang=o.initial.lang||this.lang,o.environment=o.initial.environment||this.environment},_bindEventListeners:function(){n.info("{SEARCH} bindEventListeners()"),this.catalog.on("select",function(e){n.info("*select* triggered"),t.trigger("resource:loading",e)})},remove:function(){this.catalog.dispose(),t.View.prototype.remove.apply(this,arguments)}});return c}.apply(t,i),!(void 0!==a&&(e.exports=a))},function(e,t){e.exports=n},function(e,t){e.exports=i},function(e,t){e.exports=a},function(e,t,n){var i;i=function(){"use strict";return{el:"",lang:"",defaultSelectors:["resourceType","contextSystem"],environment:"",hideCloseButton:!0,pluginRegistry:{contextSystem:{selector:{id:"dropdown",source:[{value:"uneca",label:"UNECA"},{value:"cstat_training",label:"CountrySTAT Training"}],default:["uneca"],hideSummary:!0,config:{plugins:["remove_button"],mode:"multi"}},template:{hideRemoveButton:!1},format:{output:"enumeration",metadataAttribute:"dsd.contextSystem"}}}}}.call(t,n,t,e),!(void 0!==i&&(e.exports=i))},function(e,t){e.exports=o},function(e,t,n){var i;i=function(){"use strict";var e="";return{MISSING_CONTAINER:e+"missing_container",MISSING_BUTTONS:e+"missing_button"}}.call(t,n,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,n){var i=n(13);e.exports=(i.default||i).template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div data-role="modal" class="modal fade catalog-modal catalog-dm" tabindex="-1" role="dialog" aria-labelledby="analysisCatalog">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n\n            <div id="catalog-container"></div>\n\n\n\n        </div>\n    </div>\n</div>'},useData:!0})},function(e,t,n){e.exports=n(14).default},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(){var e=new s.HandlebarsEnvironment;return f.extend(e,s),e.SafeString=l.default,e.Exception=u.default,e.Utils=f,e.escapeExpression=f.escapeExpression,e.VM=v,e.template=function(t){return v.template(t,e)},e}t.__esModule=!0;var r=n(15),s=a(r),d=n(29),l=i(d),c=n(17),u=i(c),h=n(16),f=a(h),p=n(30),v=a(p),m=n(31),g=i(m),D=o();D.create=o,g.default(D),D.default=D,t.default=D,e.exports=t.default},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n){this.helpers=e||{},this.partials=t||{},this.decorators=n||{},d.registerDefaultHelpers(this),l.registerDefaultDecorators(this)}t.__esModule=!0,t.HandlebarsEnvironment=a;var o=n(16),r=n(17),s=i(r),d=n(18),l=n(26),c=n(28),u=i(c),h="4.0.5";t.VERSION=h;var f=7;t.COMPILER_REVISION=f;var p={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0"};t.REVISION_CHANGES=p;var v="[object Object]";a.prototype={constructor:a,logger:u.default,log:u.default.log,registerHelper:function(e,t){if(o.toString.call(e)===v){if(t)throw new s.default("Arg not supported with multiple helpers");o.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if(o.toString.call(e)===v)o.extend(this.partials,e);else{if("undefined"==typeof t)throw new s.default('Attempting to register a partial called "'+e+'" as undefined');this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,t){if(o.toString.call(e)===v){if(t)throw new s.default("Arg not supported with multiple decorators");o.extend(this.decorators,e)}else this.decorators[e]=t},unregisterDecorator:function(e){delete this.decorators[e]}};var m=u.default.log;t.log=m,t.createFrame=o.createFrame,t.logger=u.default},function(e,t){"use strict";function n(e){return c[e]}function i(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e}function a(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}function o(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}return h.test(e)?e.replace(u,n):e}function r(e){return!e&&0!==e||!(!v(e)||0!==e.length)}function s(e){var t=i({},e);return t._parent=e,t}function d(e,t){return e.path=t,e}function l(e,t){return(e?e+".":"")+t}t.__esModule=!0,t.extend=i,t.indexOf=a,t.escapeExpression=o,t.isEmpty=r,t.createFrame=s,t.blockParams=d,t.appendContextPath=l;var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},u=/[&<>"'`=]/g,h=/[&<>"'`=]/,f=Object.prototype.toString;t.toString=f;var p=function(e){return"function"==typeof e};p(/x/)&&(t.isFunction=p=function(e){return"function"==typeof e&&"[object Function]"===f.call(e)}),t.isFunction=p;var v=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===f.call(e)};t.isArray=v},function(e,t){"use strict";function n(e,t){var a=t&&t.loc,o=void 0,r=void 0;a&&(o=a.start.line,r=a.start.column,e+=" - "+o+":"+r);for(var s=Error.prototype.constructor.call(this,e),d=0;d<i.length;d++)this[i[d]]=s[i[d]];Error.captureStackTrace&&Error.captureStackTrace(this,n),a&&(this.lineNumber=o,this.column=r)}t.__esModule=!0;var i=["description","fileName","lineNumber","message","name","number","stack"];n.prototype=new Error,t.default=n,e.exports=t.default},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e){r.default(e),d.default(e),c.default(e),h.default(e),p.default(e),m.default(e),D.default(e)}t.__esModule=!0,t.registerDefaultHelpers=a;var o=n(19),r=i(o),s=n(20),d=i(s),l=n(21),c=i(l),u=n(22),h=i(u),f=n(23),p=i(f),v=n(24),m=i(v),g=n(25),D=i(g)},function(e,t,n){"use strict";t.__esModule=!0;var i=n(16);t.default=function(e){e.registerHelper("blockHelperMissing",function(t,n){var a=n.inverse,o=n.fn;if(t===!0)return o(this);if(t===!1||null==t)return a(this);if(i.isArray(t))return t.length>0?(n.ids&&(n.ids=[n.name]),e.helpers.each(t,n)):a(this);if(n.data&&n.ids){var r=i.createFrame(n.data);r.contextPath=i.appendContextPath(n.data.contextPath,n.name),n={data:r}}return o(t,n)})},e.exports=t.default},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var a=n(16),o=n(17),r=i(o);t.default=function(e){e.registerHelper("each",function(e,t){function n(t,n,o){l&&(l.key=t,l.index=n,l.first=0===n,l.last=!!o,c&&(l.contextPath=c+t)),d+=i(e[t],{data:l,blockParams:a.blockParams([e[t],t],[c+t,null])})}if(!t)throw new r.default("Must pass iterator to #each");var i=t.fn,o=t.inverse,s=0,d="",l=void 0,c=void 0;if(t.data&&t.ids&&(c=a.appendContextPath(t.data.contextPath,t.ids[0])+"."),a.isFunction(e)&&(e=e.call(this)),t.data&&(l=a.createFrame(t.data)),e&&"object"==typeof e)if(a.isArray(e))for(var u=e.length;s<u;s++)s in e&&n(s,s,s===e.length-1);else{var h=void 0;for(var f in e)e.hasOwnProperty(f)&&(void 0!==h&&n(h,s-1),h=f,s++);void 0!==h&&n(h,s-1,!0)}return 0===s&&(d=o(this)),d})},e.exports=t.default},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var a=n(17),o=i(a);t.default=function(e){e.registerHelper("helperMissing",function(){if(1!==arguments.length)throw new o.default('Missing helper: "'+arguments[arguments.length-1].name+'"')})},e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var i=n(16);t.default=function(e){e.registerHelper("if",function(e,t){return i.isFunction(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||i.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers.if.call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})})},e.exports=t.default},function(e,t){"use strict";t.__esModule=!0,t.default=function(e){e.registerHelper("log",function(){for(var t=[void 0],n=arguments[arguments.length-1],i=0;i<arguments.length-1;i++)t.push(arguments[i]);var a=1;null!=n.hash.level?a=n.hash.level:n.data&&null!=n.data.level&&(a=n.data.level),t[0]=a,e.log.apply(e,t)})},e.exports=t.default},function(e,t){"use strict";t.__esModule=!0,t.default=function(e){e.registerHelper("lookup",function(e,t){return e&&e[t]})},e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var i=n(16);t.default=function(e){e.registerHelper("with",function(e,t){i.isFunction(e)&&(e=e.call(this));var n=t.fn;if(i.isEmpty(e))return t.inverse(this);var a=t.data;return t.data&&t.ids&&(a=i.createFrame(t.data),a.contextPath=i.appendContextPath(t.data.contextPath,t.ids[0])),n(e,{data:a,blockParams:i.blockParams([e],[a&&a.contextPath])})})},e.exports=t.default},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e){r.default(e)}t.__esModule=!0,t.registerDefaultDecorators=a;var o=n(27),r=i(o)},function(e,t,n){"use strict";t.__esModule=!0;var i=n(16);t.default=function(e){e.registerDecorator("inline",function(e,t,n,a){var o=e;return t.partials||(t.partials={},o=function(a,o){var r=n.partials;n.partials=i.extend({},r,t.partials);var s=e(a,o);return n.partials=r,s}),t.partials[a.args[0]]=a.fn,o})},e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var i=n(16),a={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(e){if("string"==typeof e){var t=i.indexOf(a.methodMap,e.toLowerCase());e=t>=0?t:parseInt(e,10)}return e},log:function(e){if(e=a.lookupLevel(e),"undefined"!=typeof console&&a.lookupLevel(a.level)<=e){var t=a.methodMap[e];console[t]||(t="log");for(var n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];console[t].apply(console,i)}}};t.default=a,e.exports=t.default},function(e,t){"use strict";function n(e){this.string=e}t.__esModule=!0,n.prototype.toString=n.prototype.toHTML=function(){return""+this.string},t.default=n,e.exports=t.default},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){var t=e&&e[0]||1,n=g.COMPILER_REVISION;if(t!==n){if(t<n){var i=g.REVISION_CHANGES[n],a=g.REVISION_CHANGES[t];throw new m.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+a+").")}throw new m.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}}function r(e,t){function n(n,i,a){a.hash&&(i=p.extend({},i,a.hash),a.ids&&(a.ids[0]=!0)),n=t.VM.resolvePartial.call(this,n,i,a);var o=t.VM.invokePartial.call(this,n,i,a);if(null==o&&t.compile&&(a.partials[a.name]=t.compile(n,e.compilerOptions,t),o=a.partials[a.name](i,a)),null!=o){if(a.indent){for(var r=o.split("\n"),s=0,d=r.length;s<d&&(r[s]||s+1!==d);s++)r[s]=a.indent+r[s];o=r.join("\n")}return o}throw new m.default("The partial "+a.name+" could not be compiled when running in runtime-only mode")}function i(t){function n(t){return""+e.main(a,t,a.helpers,a.partials,r,d,s)}var o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=o.data;i._setup(o),!o.partial&&e.useData&&(r=u(t,r));var s=void 0,d=e.useBlockParams?[]:void 0;return e.useDepths&&(s=o.depths?t!==o.depths[0]?[t].concat(o.depths):o.depths:[t]),(n=h(e.main,n,a,o.depths||[],r,d))(t,o)}if(!t)throw new m.default("No environment passed to template");if(!e||!e.main)throw new m.default("Unknown template object: "+typeof e);e.main.decorator=e.main_d,t.VM.checkRevision(e.compiler);var a={strict:function(e,t){if(!(t in e))throw new m.default('"'+t+'" not defined in '+e);return e[t]},lookup:function(e,t){for(var n=e.length,i=0;i<n;i++)if(e[i]&&null!=e[i][t])return e[i][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:p.escapeExpression,invokePartial:n,fn:function(t){var n=e[t];return n.decorator=e[t+"_d"],n},programs:[],program:function(e,t,n,i,a){var o=this.programs[e],r=this.fn(e);return t||a||i||n?o=s(this,e,r,t,n,i,a):o||(o=this.programs[e]=s(this,e,r)),o},data:function(e,t){for(;e&&t--;)e=e._parent;return e},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n=p.extend({},t,e)),n},noop:t.VM.noop,compilerInfo:e.compiler};return i.isTop=!0,i._setup=function(n){n.partial?(a.helpers=n.helpers,a.partials=n.partials,a.decorators=n.decorators):(a.helpers=a.merge(n.helpers,t.helpers),e.usePartial&&(a.partials=a.merge(n.partials,t.partials)),(e.usePartial||e.useDecorators)&&(a.decorators=a.merge(n.decorators,t.decorators)))},i._child=function(t,n,i,o){if(e.useBlockParams&&!i)throw new m.default("must pass block params");if(e.useDepths&&!o)throw new m.default("must pass parent depths");return s(a,t,e[t],n,0,i,o)},i}function s(e,t,n,i,a,o,r){function s(t){var a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],s=r;return r&&t!==r[0]&&(s=[t].concat(r)),n(e,t,e.helpers,e.partials,a.data||i,o&&[a.blockParams].concat(o),s)}return s=h(n,s,e,r,i,o),s.program=t,s.depth=r?r.length:0,s.blockParams=a||0,s}function d(e,t,n){return e?e.call||n.name||(n.name=e,e=n.partials[e]):e="@partial-block"===n.name?n.data["partial-block"]:n.partials[n.name],e}function l(e,t,n){n.partial=!0,n.ids&&(n.data.contextPath=n.ids[0]||n.data.contextPath);var i=void 0;if(n.fn&&n.fn!==c&&(n.data=g.createFrame(n.data),i=n.data["partial-block"]=n.fn,i.partials&&(n.partials=p.extend({},n.partials,i.partials))),void 0===e&&i&&(e=i),void 0===e)throw new m.default("The partial "+n.name+" could not be found");if(e instanceof Function)return e(t,n)}function c(){return""}function u(e,t){return t&&"root"in t||(t=t?g.createFrame(t):{},t.root=e),t}function h(e,t,n,i,a,o){if(e.decorator){var r={};t=e.decorator(t,r,n,i&&i[0],a,o,i),p.extend(t,r)}return t}t.__esModule=!0,t.checkRevision=o,t.template=r,t.wrapProgram=s,t.resolvePartial=d,t.invokePartial=l,t.noop=c;var f=n(16),p=a(f),v=n(17),m=i(v),g=n(15)},function(e,t){(function(n){"use strict";t.__esModule=!0,t.default=function(e){var t="undefined"!=typeof n?n:window,i=t.Handlebars;e.noConflict=function(){return t.Handlebars===e&&(t.Handlebars=i),e}},e.exports=t.default}).call(t,function(){return this}())},function(e,t){e.exports=r},function(e,t){e.exports=s},function(e,t,n){var i;i=function(){"use strict";return{closeButton:!1,debug:!1,newestOnTop:!1,progressBar:!0,positionClass:"toast-top-right",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"2500",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"}}.call(t,n,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,n){var i;i=function(){"use strict";return{"(/)":"onLanding","(/)landing(/)":"onLanding","(/)home(/)":"onHome","(/)add(/)":"onAdd","(/)metadata(/)":"onMetadata","(/)dsd(/)":"onDSD","(/)data(/)":"onData","(/)close(/)":"onClose","(/)delete(/)":"onDelete","(/)search(/)":"onSearch","(/)not-found(/)":"onNotFound","(/)denied(/)":"onDenied","(/)*path":"onDefaultRoute"}}.call(t,n,t,e),!(void 0!==i&&(e.exports=i))},function(e,t){e.exports=d},function(e,t,n){var i;i=function(){"use strict";return{items:[{attrs:{id:"home"},label:{EN:"Home",FR:"Accueil"}},{attrs:{id:"landing"},label:{EN:"Landing",FR:"Landing FR"}},{attrs:{id:"search"},label:{EN:"Search",FR:"Rchercher"}},{attrs:{id:"add"},label:{EN:"Add",FR:"Ajouter"}},{attrs:{id:"metadata"},label:{EN:"Metadata",FR:"Métadonnées"}},{attrs:{id:"dsd"},label:{EN:"DSD",FR:"DSD"}},{attrs:{id:"data"},label:{EN:"Data",FR:"Données"}},{attrs:{id:"delete"},label:{EN:"Delete",FR:"Supprimer"}},{attrs:{id:"close"},label:{EN:"Close",FR:"Annuller"}}],languages:[],active:["landing","search"]}}.call(t,n,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,n){var i,a;i=[n(3),n(6),n(2),n(39),n(42),n(11)],a=function(e,t,n,i,a,o){"use strict";var r={btnSearch:"#btnSearch",btnAdd:"#btnAdd"},s=t.View.extend({render:function(t){e.extend(!0,this,{initial:t}),this._parseInput();var i=this._validateInput();return i===!0?(n.info("Rendering View - Landing",this),this.$container.html(a),this._bindEventListeners(),this):(n.error("Impossible to render Landing"),void n.error(i))},_validateInput:function(){var e=!0,t=[];return 0===this.$container.length&&(t.push({code:o.MISSING_CONTAINER}),n.warn("Impossible to find container")),t.length>0?t:e},_parseInput:function(){this.$container=e(this.initial.container),this.cache=this.initial.cache,this.environment=this.initial.environment,this.lang=this.initial.lang.toLowerCase()},_bindEventListeners:function(){e(r.btnSearch).on("click",function(){t.trigger("button:search")}),e(r.btnAdd).on("click",function(){t.trigger("button:new")})},_removeEventListeners:function(){e(r.btnSearch).off("click"),e(r.btnAdd).off("click")},remove:function(){this._removeEventListeners(),t.View.prototype.remove.apply(this,arguments)}});return s}.apply(t,i),!(void 0!==a&&(e.exports=a))},function(e,t,n){var i,a;i=[n(40),n(41)],a=function(e,t){"use strict";return{en:e,fr:t}}.apply(t,i),!(void 0!==a&&(e.exports=a))},function(e,t,n){var i;i=function(){"use strict";return{confirmDataRemove:"Do you want to remove all your data?",success:"Success",resourceNew:"Resource created",resourceSaved:"Resource saved",resourceDeleted:"Resource deleted",resourceLoaded:"Resource loaded",resourceCopied:"Resource copied",error:"Error",errorMetaMinimum:'Please fill the minimum set of metadata in the "Identification" and "Contacts" sections',errorParsingJson:"Error parsing Json file, check the structure and try again",errorLoadinResource:"Error loading the resource",errorSavingResource:"Error saving the resource",overwriteExistingDSD:"This operation will overwrite the DSD you're working on, continue?",unsavedWarning:"Some changes are not saved, do you want to continue without saving?",downloadDSD:"Download DSD",uploadDSD:"Upload DSD",invalidData:"Data is not valid",nullDSDCols:"DSD has no columns",nullCsvCols:"CSV has no columns",wrongColumnCount:"The columns' count in the CSV must match the one in the DSD",wrongColumnId:"The columns' names in the CSV must match the IDs in the DSD",unknownCodes:"Some codes could not be found in a codelist",DataMatchColumn:"Match the DSD columns with the CSV ones",DataDuplicateFound:"Some duplicated values found, keep old data or replace with the new values just uploaded?",btnDataMergeKeepNew:"Replace with new values",btnDataMergeKeepOld:"Keep old values",btnDataMergeCancel:"Cancel",DataEditorMainContainer:"LOADING...",DataDeleteAll:"Delete all",DatalblUpload:"Upload",DatalblSeparator:"CSV Separator",DatalblcsvSeparatorSemi:"Semicolon",DatalblcsvSeparatorComma:"Comma",unknownCode:"Unknown code",invalidYear:"Invalid year",invalidMonth:"Invalid month",invalidDate:"Invalid date",invalidNumber:"Invalid number",invalidBool:"Invalid boolean",btnSearch:"SEARCH",btnAdd:"ADD",btnMetadata:"METADATA",btnDSD:"DSD",btnData:"DATA",btnSaveMeta:"Save",btnCopyMeta:"Copy Metadata",btnLoadMeta:"Load",btnSaveDSD:"Save",btnClose:"Close",btnCsvMatcherOk:"OK",btnCsvMatcherCancel:"Cancel",btnHome:"Home",btnDeleteUndo:"Undo",btnDeleteConfirm:"Confirm",dataEditEnd:"Save",btnSave:"Save",DManHeader:"FENIX Data Management",DManResHeader:"Edit Resource",MetaHeader:"Metadata Editor",MetaCopyHeader:"Copy metadata from resource",DSDHeader:"Data Structure Definition Editor",DataHeader:"Data Editor",CloseHeader:"Resource Closed",DeleteHeader:"Delete Resource?",DManIntro:"Data management is the process of controlling the information generated during a research project. Any research will require some level of data management, and funding agencies are increasingly requiring scholars to plan and execute good data management practices.",CopyMetaRID:"Resource Identification Code",CopyMetaVer:"Resource Version (if applicable)",NoTitle:"Untitled"}}.call(t,n,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,n){var i;i=function(){"use strict";return{confirmDataRemove:"Voulez-vous supprimer toutes les données?",success:"Réussite",resourceNew:"Ressource Créée",resourceSaved:"Ressource enregistrée",resourceDeleted:"Ressource supprimée",resourceLoaded:"Ressource chargée",resourceCopied:"Ressource copiée",error:"Erreur",errorMetaMinimum:'Remplissez l\'ensemble minimale de métadonnées dans les sections "Identification" et "Contacts"',errorParsingJson:"Erreur d'analyse du fichier Json, vérifiez la structure et essayez de nouveau",errorLoadinResource:"Erreur de chargement de la ressource",errorSavingResource:"Erreur de sauvegarde de la ressource",overwriteExistingDSD:"Cette opération écrasera le DSD sur lequel vous travaillez, voulez-vous continuer?",unsavedWarning:"Certaines modifications ne sont pas enregistrées changes are not saved, voulez-vous continuer sans enregistrer?",downloadDSD:"Téléchargez le DSD",uploadDSD:"Uploadez le DSD",invalidData:"Les données ne sont pas valides",
nullDSDCols:"Le DSD n'a pas de colonnes",nullCsvCols:"Le CSV n'a pas de colonnes",wrongColumnCount:"Le nombre des colonnes dans le CSV doit correspondre à celui du DSD",wrongColumnId:"Les noms des colonnes dans le CSV doivent correspondre aux IDs dans le DSD",unknownCodes:"Des codes n'ont pas été trouvés dans la codeliste",DataMatchColumn:"Faites correspondre les colonnes du DSD avec celles du CSV",DataDuplicateFound:"Des valeurs dupliquées ont été trouvées, voulez-vous conserver les vieilles valeurs ou les remplacer avec les nouvelles?",btnDataMergeKeepNew:"Remplacer avec les nouvelles valeurs",btnDataMergeKeepOld:"Conserver les vieilles valeurs",btnDataMergeCancel:"Annulez",DataEditorMainContainer:"Chargement en cours...",DataDeleteAll:"Supprimez tous",DatalblUpload:"Téléchargez",DatalblSeparator:"Séparateur du CSV",DatalblcsvSeparatorSemi:"Point-virgule",DatalblcsvSeparatorComma:"Virgule",unknownCode:"Code inconnu",invalidYear:"Année non valide",invalidMonth:"Mois non valide",invalidDate:"Date non valide",invalidNumber:"Nombre non valide",invalidBool:"Valeur booléenne non valide",btnSearch:"RCHERCHER",btnAdd:"AJOUTER",btnMetadata:"MÉTADONNÉES",btnDSD:"DSD",btnData:"DONNÉES",btnSaveMeta:"Enregistrer",btnCopyMeta:"Copier les métadonnées",btnLoadMeta:"Charger",btnSaveDSD:"Enregistrer",btnClose:"Annuler",btnCsvMatcherOk:"OK",btnCsvMatcherCancel:"Annuler",btnHome:"Accueil",btnDeleteUndo:"Annuler",btnDeleteConfirm:"Confirmer",dataEditEnd:"Enregistrer",btnSave:"Enregistrer",DManHeader:"Gestion des Données FENIX",DManResHeader:"Éditer la Ressource",MetaHeader:"Éditeur des Métadonnées",MetaCopyHeader:"Copier les métadonnées d'une ressource",DSDHeader:"Éditeur de la Définition de la Structure des Données",DataHeader:"Éditeur des Données",CloseHeader:"Ressource fermée",DeleteHeader:"Voulez-vous supprimer la ressource?",DManIntro:"La gestion des données est le processus de contrôle des informations générées lors d'un projet de recherche. Toutes les recherches nécessiteront d'un certain niveau de gestion des données, et les organismes de financement sont de plus en plus exigeant que les chercheurs planifient et exécutent des bonnes pratiques de gestion des données.",CopyMetaRID:"Code d'identification de la Ressource",CopyMetaVer:"Version de la Ressource (si applicable)",NoTitle:"Sans Titre"}}.call(t,n,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,n){var i=n(13);e.exports=(i.default||i).template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div class="row">\n    <div class="col-xs-12">\n        <div class="datamng-welcome">\n            <h3 id="DManHeader">Fenix Data Editor</h3>\n            <p id="DManIntro">Data management is the process of controlling the information generated during a research project. Any research will require some level of data management, and funding agencies are increasingly requiring scholars to plan and execute good data management practices.</p>\n\n            <!--<div id="btnSearch" class="datamng-welcome-btn">-->\n                <!--<a>-->\n                    <!--<span class="icojam_base_search_in"></span><br>-->\n                    <!--<span id="btnSearchText">Search</span>-->\n                <!--</a>-->\n            <!--</div>-->\n\n            <button id="btnSearch" class="btn btn-default fx-button-primary-color" > Search </button>\n\n            <button id="btnAdd" class="btn btn-default fx-button-primary-color" > Add </button>\n\n            <!--<div id="btnAdd" class="datamng-welcome-btn">-->\n                <!--<a>-->\n                    <!--<span class="icojam_add"></span><br>-->\n                    <!--<span id="btnAddText">Add</span>-->\n                <!--</a>-->\n            <!--</div>-->\n        </div>\n\n\n    </div>\n</div>\n'},useData:!0})},function(e,t,n){var i,a;i=[n(3),n(6),n(2),n(11)],a=function(e,t,n,i){"use strict";var a=t.View.extend({render:function(t){e.extend(!0,this,{initial:t}),this._parseInput();var i=this._validateInput();return i===!0?(n.info("Rendering View - Not Found",this),this.$container.html("<h1>Oh snap! Error 404</h1>"),this):(n.error("Impossible to render Not Found"),void n.error(i))},_validateInput:function(){var e=!0,t=[];return 0===this.$container.length&&(t.push({code:i.MISSING_CONTAINER}),n.warn("Impossible to find container")),t.length>0?t:e},_parseInput:function(){this.$container=e(this.initial.container),this.lang=this.initial.lang.toLowerCase()},remove:function(){t.View.prototype.remove.apply(this,arguments)}});return a}.apply(t,i),!(void 0!==a&&(e.exports=a))},function(e,t,n){var i,a;i=[n(3),n(6),n(2),n(7),n(39),n(45),n(46),n(11)],a=function(e,t,n,i,a,o,r,s){"use strict";var d={HEADER:"#DeleteHeader",BTN_CONFIRM:"#btnDeleteConfirm",BTN_UNDO:"#btnDeleteUndo"},l=t.View.extend({render:function(t){e.extend(!0,this,{initial:t}),this._parseInput();var i=this._validateInput();return i===!0?(n.info("Rendering View - Delete",t),this._initViews(),this._bindEventListeners(),this):(n.error("Impossible to render Landing"),void n.error(i))},_validateInput:function(){var e=!0,t=[];return 0===this.$container.length&&(t.push({code:s.MISSING_CONTAINER}),n.warn("Impossible to find container")),t.length>0?t:e},_parseInput:function(){this.$container=e(this.initial.container),this.cache=this.initial.cache,this.environment=this.initial.environment,this.lang=this.initial.lang.toLowerCase()},_initViews:function(){this.$container.html(o),e(this.$container.find(d.HEADER)).html(a[this.lang].DeleteHeader)},_bindEventListeners:function(){n.info("{DELETE} bindEventListeners()"),e(this.$container.find(d.BTN_CONFIRM)).on("click",function(){t.trigger("resource:delete")}),e(this.$container.find(d.BTN_UNDO)).on("click",function(){t.trigger("button:undo")})},_removeEventListeners:function(){e(this.$container.find(d.BTN_CONFIRM)).off("click"),e(this.$container.find(d.BTN_UNDO)).off("click")},accessControl:function(t){return new i.Promise(function(n,i){e.isEmptyObject(t)?i():n()})},remove:function(){this._removeEventListeners(),t.View.prototype.remove.apply(this,arguments)}});return l}.apply(t,i),!(void 0!==a&&(e.exports=a))},function(e,t,n){var i=n(13);e.exports=(i.default||i).template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div class="row">\n    <div class="col-xs-12">\n        <div class="datamng-welcome">\n            <h3 id="DeleteHeader">Delete Resource?</h3>\n            <div id="btnDeleteConfirm" class="datamng-welcome-btn">\n                <a id="delete-confirm">\n                    <span class="icojam_delete"></span><br>\n                    <span>Confirm</span>\n                </a>\n            </div>\n\n            <div id="btnDeleteUndo" class="datamng-welcome-btn">\n                <a id="delete-undo">\n                    <span class="icojam_cancel_1"></span><br>\n                    <span>Undo</span>\n                </a>\n            </div>\n\n\n        </div>\n    </div>\n</div>'},useData:!0})},function(e,t,n){var i,a;i=[n(3),n(32),n(2),n(7),n(10),n(6)],a=function(e,t,n,i,a,o){"use strict";function r(){n.info("FENIX DM - Resource Manager"),this.bridge=new a({environment:this.environment}),n.info("FENIX DM - RM : We'll work on '"+this.environment+"' environment."),this.resource={},this.url=s,n.info("FENIX DM - Resource Manager completed.",this)}var s={baseUrl:"http://fenix.fao.org/d3s_dev/msd/",develop:"http://fenix.fao.org/d3s_dev/msd/",production:"http://fenixservices.fao.org/d3s/msd/",saveMetadata:"resources/metadata",saveDSD:"resources/dsd",saveData:"resources"};return r.prototype.setEnvironment=function(e){this.environment=e,this.bridge=new a({environment:e}),this.url.baseUrl=s[e],n.info("FENIX DM - Current Environment: "+e+" ["+this.url.baseUrl+"]")},r.prototype.getEnvironment=function(){return n.info("FENIX DM - Current Environment: "+this.environment),n.info("FENIX DM - Current Bridge Environment: "+this.bridge.environment),this.environment},r.prototype.isResourceValid=function(e){return this.isMetaValid(e.metadata)&&this.isDSDValid(e.metadata.dsd)&&this.isDataValid(e.data)},r.prototype.isDSDValid=function(e){if(!e)throw new Error("DSD to update cannot be null");if(!e.datasources)throw new Error("Datasources cannot be null");if(0==e.datasources.length)throw new Error("Datasources cannot be null");if(!e.contextSystem)throw new Error("ContextSystem cannot be null");return!0},r.prototype.isDataValid=function(e){return!0},r.prototype.isMetaValid=function(e){return!0},r.prototype.isDSDEmpty=function(){return void 0===this.resource.metadata.dsd.columns},r.prototype.isDSDEditable=function(){return void 0===this.resource.data},r.prototype.newResource=function(e,t){n.info("RM: new Resource",e),this.resource={},this.resource.metadata={},this.resource.metadata.dsd=e,t||o.trigger("resource:new")},r.prototype.deleteResource=function(){n.info("RM: deleteResource through "+this.url.baseUrl+"resources/uid/"+this.resource.metadata.uid),e.ajax({url:this.url.baseUrl+"resources/uid/"+this.resource.metadata.uid,type:"DELETE",crossDomain:!0,dataType:"text",success:function(){this.resource=null,o.trigger("resource:deleted")},error:function(e,t){o.trigger("error:showerrorsrv",null,e)}})},r.prototype.isResourceAvailable=function(){return e.isEmptyObject(this.resource)},r.prototype.unloadResource=function(){n.info("RM - unloadResource"),this.resource={},o.trigger("resource:unloaded")},r.prototype.createResource=function(t,i){var a=this;n.info("[createResource] I'm trying to upload this: ",JSON.stringify(t)),e.ajax({contentType:"application/json",url:this.url.baseUrl+i,dataType:"json",type:"POST",data:JSON.stringify(t),crossDomain:!0,success:function(e){a.resource.metadata=e,o.trigger("resource:updated")},error:function(e){o.trigger("error:showerrorsrv",null,e)}})},r.prototype.updateResource=function(t,i){var a=this;return void 0===a.resource.metadata.uid?(n.info("RM - Switching to create."),void this.createResource(t,i)):(n.info("[updateResource] I'm trying to upload this: ",JSON.stringify(t)),void e.ajax({contentType:"application/json",url:this.url.baseUrl+i,dataType:"json",type:"PUT",data:JSON.stringify(t),crossDomain:!0,success:function(e){o.trigger("resource:updated")},error:function(e,t){o.trigger("error:showerrorsrv",null,e)}}))},r.prototype.getCodelist=function(e){n.info("getCodelist called ",e);var t={uid:e};return e.indexOf("|")!=-1&&(t.version=e.substr(e.indexOf("|")+1,e.length),t.uid=e.substr(0,e.indexOf("|"))),n.info(">bridge.getResource",t),this.bridge.getResource(t).then(function(e){return n.info("<bridge.getResource",e),e})},r.prototype.loadResource=function(e){n.info("Load resource",e),n.info("Loading: "+e.model.uid),this.bridge.getResource({uid:e.model.uid,params:{dsd:!0,full:!0}}).then(t.bind(this._onLoadResourceSuccess,this),t.bind(this._onLoadResourceError,this))},r.prototype._onLoadResourceSuccess=function(e){n.info("Load resource success",e),this.resource=e,n.info("navigate to home"),o.trigger("resource:loaded")},r.prototype._onLoadResourceError=function(e){n.error("Load resource error",e),n.error(e)},r.prototype.getMetadataFromServer=function(){this.bridge.getMetadata({body:[],uid:this.resource.metadata.uid}).then(t.bind(this._onGetMetadataSuccess,this),t.bind(this._onGetMetadataError,this))},r.prototype.getMetadata=function(){return n.info("getMetadata",this.resource.metadata),this.isMetaValid(this.resource.metadata)?this.resource.metadata:{}},r.prototype._onGetMetadataSuccess=function(e){return n.info("_onGetMetadataSuccess"),n.info(e),e},r.prototype._onGetMetadataError=function(e){return n.error("_onGetMetadataError"),n.error(e),!1},r.prototype.setMetadata=function(e){if(n.info("setMetadata Called."),this.isMetaValid(e)){var t=this.resource.metadata.dsd;this.resource.metadata=e,this.resource.metadata.dsd=t,this.resource.metadata.meContent={resourceRepresentationType:"dataset"},this.resource.metadata.contacts&&(this.resource.metadata.contacts.contactInfo={address:this.resource.metadata.contacts.address,emailAddress:this.resource.metadata.contacts.emailAddress,phone:this.resource.metadata.contacts.phone,hoursOfService:this.resource.metadata.contacts.hoursOfService,contactInstruction:this.resource.metadata.contacts.contactInstruction}),this.updateMeta(this.resource.metadata)}},r.prototype.updateMeta=function(e){n.info("updateMeta called",e),this.updateResource(e,this.url.saveMetadata)},r.prototype.getDSD=function(){return void 0===this.resource?null:void 0===this.resource.metadata?null:void 0===this.resource.metadata.dsd?null:(n.info("getDSD Called.",this.resource.metadata.dsd),this.resource.metadata.dsd)},r.prototype.getDSDColumns=function(){return void 0===this.resource?null:void 0===this.resource.metadata?null:void 0===this.resource.metadata.dsd?null:void 0===this.resource.metadata.dsd.columns?null:(n.info("getDSDColumns Called.",this.resource.metadata.dsd.columns),this.resource.metadata.dsd.columns)},r.prototype.setDSDColumns=function(e){this.resource.metadata.dsd.columns=e,this.updateDSD(this.resource.metadata.dsd)},r.prototype.setDSD=function(e){var t=this.resource.metadata.dsd;t.columns=e,n.info("setDSD Called.",t),this.isDSDValid(t)&&(this.resource.metadata.dsd=t,this.updateDSD(this.resource.metadata.dsd))},r.prototype.updateDSD=function(e){n.info("updateDSD called",e),this.updateResource(e,this.url.saveDSD)},r.prototype.getData=function(){return n.info("getData called.",this.resource.data),this.resource.data},r.prototype.setDataEmpty=function(){n.info("setDataEmpty called."),this.resource.data={}},r.prototype.setData=function(e){n.info("setData called.",e),this.isDataValid(e)&&(this.resource.data=e,this.updateData(this.resource))},r.prototype.updateData=function(e){n.info("updateData called",e),this.updateResource(e,this.url.saveData)},r.prototype.getCurrentResourceCodelists=function(){if(n.info("getCurrentResourceCodelists called."),void 0===this.resource.metadata)return null;if(void 0===this.resource.metadata.dsd)return null;if(void 0===this.resource.metadata.dsd.columns)return null;var i=[],a=this.resource.metadata.dsd.columns;return e.each(a,function(e,t){var n="";"code"==t.dataType&&(n=t.domain.codes[0].idCodeList,t.domain.codes[0].version&&(n=n+"|"+t.domain.codes[0].version),i.push(n))}),t.unique(i)},r.prototype.generateDSDStructure=function(){n.info("generateDSDStructure called.");var t=this,a=t.getCurrentResourceCodelists(),o=[];return e.each(a,function(e,n){o.push(t.getCodelist(n))}),i.all(o).then(function(t){var n={};return e.each(t,function(e,t){t.metadata.version?n[t.metadata.uid+"|"+t.metadata.version]=t:n[t.metadata.uid]=t}),n})},new r}.apply(t,i),!(void 0!==a&&(e.exports=a))},function(e,t,n){var i,a;i=[n(3),n(6),n(2),n(7),n(48),n(46),n(11)],a=function(e,t,n,i,a,o,r){"use strict";var s=t.View.extend({render:function(t){e.extend(!0,this,{initial:t}),this._parseInput();var i=this._validateInput();return i===!0?(n.info("Rendering View - Metadata",this),this._initViews(),this._bindEventListeners(),this):(n.error("Impossible to render Metadata"),void n.error(i))},_validateInput:function(){var e=!0,t=[];return 0===this.$container.length&&(t.push({code:r.MISSING_CONTAINER}),n.warn("Impossible to find container")),this.$savebtn.is(":visible")||(t.push({code:r.MISSING_BUTTONS}),n.warn("Impossible to find save buttons")),t.length>0?t:e},_parseInput:function(){this.$container=e(this.initial.container),this.environment=this.initial.environment,this.lang=this.initial.lang.toLowerCase(),this.model=this.initial.model,this.config=this.initial.metadataEditor,this.$savebtn=e(this.initial.savebtn)},_bindEventListeners:function(){var e=this;this.$savebtn.on("click",function(){t.trigger("meta:saving",e.MDE.getValues())})},_removeEventListeners:function(){this.$savebtn.off("click")},_initViews:function(){n.info("{MDE} initViews"),this.MDE=new a({el:this.$container,lang:this.lang,config:this.config,cache:this.cache,environment:this.environment,model:this.model})},accessControl:function(t){return new i.Promise(function(n,i){e.isEmptyObject(t)?i():n()})},remove:function(){this._removeEventListeners(),t.View.prototype.remove.apply(this,arguments)}});return s}.apply(t,i),!(void 0!==a&&(e.exports=a))},function(e,t){e.exports=l},function(e,t,n){var i,a;i=[n(3),n(6),n(2),n(7),n(50),n(46),n(11)],a=function(e,t,n,i,a,o,r){"use strict";var s=t.View.extend({render:function(t){e.extend(!0,this,{initial:t}),this._parseInput();var i=this._validateInput();return i===!0?(n.info("Rendering View - DSD",this),this._initViews(),this._bindEventListeners(),this):(n.error("Impossible to render DSD"),void n.error(i))},_validateInput:function(){var e=!0,t=[];return 0===this.$container.length&&(t.push({code:r.MISSING_CONTAINER}),n.warn("Impossible to find container")),this.$savebtn.is(":visible")||(t.push({code:r.MISSING_BUTTONS}),n.warn("Impossible to find save buttons")),t.length>0?t:e},_parseInput:function(){this.$container=e(this.initial.container),this.environment=this.initial.environment,this.lang=this.initial.lang.toLowerCase(),this.config=this.initial.config,this.$savebtn=e(this.initial.savebtn),this.model=this.initial.model,this.isEditable=this.initial.isEditable},_bindEventListeners:function(){n.info("{DSD} bindEventListeners()");var e=this;this.$savebtn.on("click",function(){n.info("{DSD} saving",e.dsd.get()),t.trigger("dsd:setcolumns",e.dsd.get())})},_initViews:function(){n.info("{DSD} initViews");var e=this.config;this.dsd=a,this.dsd.init(this.$container,e,null);var t=this.model;n.info("{DSD}",t.columns),void 0!==t.columns&&t.columns.length&&this.dsd.set(t.columns),n.info("{DSD} is editable",this.isEditable),this.dsd.editable(this.isEditable)},_removeEventListeners:function(){this.$savebtn.off("click")},accessControl:function(t){return new i.Promise(function(n,i){e.isEmptyObject(t)?i():n()})},remove:function(){n.info("{DSD} remove"),this._removeEventListeners(),this.dsd.destroy(),t.View.prototype.remove.apply(this,arguments)}});return s}.apply(t,i),!(void 0!==a&&(e.exports=a))},function(e,t){e.exports=c},function(e,t,n){var i,a;i=[n(3),n(6),n(2),n(7),n(52),n(53),n(54),n(55)],a=function(e,t,n,i,a,o,r,s){"use strict";var d={utility:"#fx-data-management-utility-holder",btnFileUploader:"#btnFileUploader",btnDelAllData:"#btnDelAllData",dataFileUpload:"#dataFUpload",csvSeparator:"input[name=csvSeparator]:checked",dataUploadColsMatch:"#DataUploadColsMatch",dataEditorContainer:"#divDataEditor",dataUploadContainer:"#DataUploadContainer",divCsvMatcher:"#divCsvMatcher",btnCsvMatcherOk:"#btnCsvMatcherOk",btnCsvMatcherCancel:"#btnCsvMatcherCancel",btnDataMergeKeepNew:"#btnDataMergeKeepNew",btnDataMergeKeepOld:"#btnDataMergeKeepOld",btnDataMergeCancel:"#btnDataMergeCancel"},l=t.View.extend({render:function(t){e.extend(!0,this,{initial:t}),this._parseInput();var i=this._validateInput();return i===!0?(n.info("{Data} Rendering View"),this._initViews(),this._initFileUploader(),this._bindEventListeners()):(n.error("Impossible to render Landing"),n.error(i)),n.info("{SOME} Rendering View",this),this},_parseInput:function(){this.$container=e(this.initial.container),this.environment=this.initial.environment,this.lang=this.initial.lang.toLowerCase(),this.cLists=this.initial.codelists,this.dsd=this.initial.dsd,this.data=this.initial.data,this.$savebtn=e(this.initial.savebtn),this.generator=this.initial.generator},_validateInput:function(){var e=!0,t=[];return 0===this.$container.length&&(t.push({code:ERR.MISSING_CONTAINER}),n.warn("Impossible to find container")),this.$savebtn.is(":visible")||(t.push({code:ERR.MISSING_BUTTONS}),n.warn("Impossible to find save buttons")),t.length>0?t:e},_initViews:function(){n.info("{Data} initViews",o);var t=o,i=this;e(d.utility).html(s),this.$dataUploadColsMatch=e(this.$container.find(d.dataUploadColsMatch)),this.$dataEditorContainer=e(this.$container.find(d.dataEditorContainer)),this.$dataUploadContainer=e(this.$container.find(d.dataUploadContainer)),this.columnsMatch=new a.Columns_Match,a.init(this.$container,t,null),n.info("{Data} Calling the Codelists"),this.generator.then(function(e){n.info("{Data} Calling the DSD");var t=i.dsd.columns;n.info("{Data} Setting the DSD..."),a.setColumns(t,e,null),n.info("{Data} DSD Columns Setted."),void 0!==i.data&&a.setData(i.data)})},_initFileUploader:function(){this.fUpload=new r({accept:["csv"]}),this.fUpload.render(this.$container.find(d.dataFileUpload))},_bindEventListeners:function(){n.info("{Data} _bindEventListeners");var i=this;e(this.$container.find(d.btnFileUploader)).on("click",function(t){t.stopPropagation(),e(d.utility).find(".dropdown-menu").toggle()}),e(this.$savebtn).on("click",function(){n.info("{DATA} saving",a.getData()),a.getData()&&t.trigger("data:saving",a.getData())}),e(this.$container.find(d.btnDataMergeKeepNew)).on("click",function(){i._CSVLoadedMergeData("keepNew")}),e(this.$container.find(d.btnDataMergeKeepOld)).on("click",function(){i._CSVLoadedMergeData("keepOld")}),e(this.$container.find(d.btnDataMergeCancel)).on("click",function(){i.tmpCsvData=null,i.tmpCsvCols=null,i._switchPanelVisibility(i.s.dataEditorContainer),e(i.s.utility).show()}),this.listenTo(t,"data:uploaded",function(e){n.info("{DATA}[EVT] data:uploaded "),i._csvLoaded(e)})},_removeEventListeners:function(){e(this.$container.find(d.btnDataMergeKeepNew)).off("click"),e(this.$container.find(d.btnDataMergeKeepOld)).off("click"),e(this.$container.find(d.btnDataMergeCancel)).off("click"),e(this.$container.find(d.btnDelAllData)).off("click"),e(this.$container.find(d.savebtn)).off("click"),e(this.$container.find(d.btnCsvMatcherCancel)).off("click"),e(this.$container.find(d.btnCsvMatcherOk)).off("click")},_CSVLoadedCheckDuplicates:function(){n.info("_CSVLoadedCheckDuplicates");var e=a.getDataWithoutValidation(),t=new a.Data_Validator,i=t.dataAppendCheck(a.getColumns(),e,this.tmpCsvData);i&&i.length>0?this._switchPanelVisibility(d.dataUploadContainer):this._CSVLoadedMergeData("keepNew")},_CSVLoadedMergeData:function(e){n.info("_CSVLoadedMergeData",e);var i=new a.Data_Validator,o=a.getDataWithoutValidation(),r=new a.Validator_CSV,s=r.validateCodes(a.getColumns(),a.getCodelists(),this.tmpCsvCols,this.tmpCsvData);if(n.info("uhm, variables",i,o,r,s),s&&s.length>0){n.info("valRes got errors");for(var d=0;d<s.length;d++)t.trigger("error:showerrormsg",[s[d].type]+" - codelist: "+s[d].codelistId+" - codes: "+s[d].codes.join(","))}var l=i.checkWrongDataTypes(a.getColumns(),this.cLists,this.tmpCsvData);if(n.info("wrongDatatypes",l),l&&l.length>0){for(n.info("wrongDatatypes got errors"),d=0;d<l.length;d++)t.trigger("error:showerrormsg",[l[d].error]+" - Row: "+l[d].dataIndex);return n.info("Don't merge, return."),this._switchPanelVisibility(this.s.dataEditorContainer),this.tmpCsvCols=null,void(this.tmpCsvData=null)}i.dataMerge(a.getColumns(),o,this.tmpCsvData,e),a.setData(o),this._switchPanelVisibility(this.s.dataEditorContainer),this.tmpCsvCols=null,this.tmpCsvData=null},_csvLoaded:function(i){n.info("{DATA} csvLoaded",i),this.fUpload.reset(),e(d.utility).hide();var o={},r=this,s=new a.CSV_To_Dataset(o,e(d.csvSeparator).val());s.convert(i),this.tmpCsvCols=s.getColumns(),this.tmpCsvData=s.getData();var l=new a.Validator_CSV;this.columnsMatch.render(e("div#divCsvMatcher")),e(d.btnCsvMatcherOk).on("click",function(){r.tmpCsvCols=r.columnsMatch.getCsvCols(),r.tmpCsvData=r.columnsMatch.getCsvData(),r._CSVLoadedCheckDuplicates()}),e(d.btnCsvMatcherCancel).on("click",function(){e(d.btnCsvMatcherCancel).off("click"),e(d.btnCsvMatcherOk).off("click"),r.tmpCsvData=null,r.tmpCsvCols=null,r._switchPanelVisibility(r.s.dataEditorContainer),e(d.utility).show()});var c=l.validate(a.getColumns(),a.getCodelists(),this.tmpCsvCols,this.tmpCsvData);if(c&&c.length>0)for(var u=0;u<c.length;u++)t.trigger("error:showerrormsg",c[u].type);else{this._switchPanelVisibility(d.dataUploadColsMatch),this.columnsMatch.setData(this.dsd,this.tmpCsvCols,this.tmpCsvData);var h=new a.Data_Validator,f=h.checkWrongDataTypes(a.getColumns(),this.cLists,this.tmpCsvData);if(f&&f.length>0)for(u=0;u<f.length;u++)t.trigger("error:showerrormsg",[f[u].error]+" - Row: "+f[u].dataIndex);else;}},_switchPanelVisibility:function(t){e(d.dataUploadColsMatch).hide(),e(d.dataEditorContainer).hide(),e(d.dataUploadContainer).hide(),e(t).show()},accessControl:function(t){return new i.Promise(function(n,i){e.isEmptyObject(t)?i():n()})},remove:function(){n.warn("{DATA} - Remove View"),this._removeEventListeners(),e(d.utility).html(""),e(d.utility).show(),t.View.prototype.remove.apply(this,arguments)}});return l}.apply(t,i),!(void 0!==a&&(e.exports=a))},function(e,t){e.exports=u},function(e,t,n){var i;i=function(){"use strict";return{D3SConnector:{getMetaAndDataUrl:"http://faostat3.fao.org:7799/v2/msd/resources"},lang:"EN"}}.call(t,n,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,n){var i,a;i=[n(3),n(2),n(6)],a=function(e,t,n){function i(n){t.info("{FUH} started."),this.config={},e.extend(!0,this.config,r,n);for(var i=0;i<this.config.accept.length;i++)this.config.accept[i]=this.config.accept[i].toLowerCase();this.$uploadInput}var a="data",o="uploaded",r={accept:[],maxFileBytes:0};return i.prototype.render=function(e){t.info("{FUH} render "),this.initUploadInput(e)},i.prototype.reset=function(){t.info("{FUH} reset "),this.$uploadInput.val("")},i.prototype.initUploadInput=function(i){t.info("{FUH} initUploadInput "),this.$uploadInput=e(i);var r=this;this.$uploadInput.on("change",function(t){if(r.config.accept&&r.config.accept.length>0){var i=r.$uploadInput.val().split(".").pop().toLowerCase();if(e.inArray(i,r.config.accept)==-1)return alert("wrong file type"),r.reset(),!1}if(0!=r.config.maxFileBytes&&t.target.files.item(0).size>r.config.maxFileBytes)return alert("too big"),r.reset(),!1;if(void 0!=t.target.files){var s=new FileReader;s.onload=function(e){var t=e.target.result;n.trigger(a+":"+o,t)},s.readAsText(t.target.files.item(0))}return!1})},i.prototype.enabled=function(e){t.info("{FUH} enabled "),e?this.$uploadInput.removeAttr("disabled"):this.$uploadInput.attr("disabled","disabled")},i.prototype.destroy=function(){t.info("{FUH} destroy "),this.$uploadInput.off("change")},i}.apply(t,i),!(void 0!==a&&(e.exports=a))},function(e,t,n){var i=n(13);e.exports=(i.default||i).template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div data-role="menu" class="dropdown">\n    <button id="btnFileUploader" class="btn btn-floating" type="button" data-toggle="dropdown" aria-expanded="true">\n        <span class="icojam_cloud_upload"></span>\n    </button>\n    <ul class="dropdown-menu json-menu">\n        <li class="js-menu dropdown-submenu">\n            <label id="lblUpload" for="dataFUpload">Upload</label>\n            <br>\n            <input type="file" name="filename" id="dataFUpload" />\n            <br>\n        </li>\n        <li class="js-menu dropdown-submenu">\n            <label id="lblSeparator" for="csvSeparator">CSV Separator</label>\n            <br>\n            <input type="radio" id="csvSeparatorComma" name="csvSeparator" value="," checked>\n                <label id="DatalblcsvSeparatorComma" class="filter-enabled-label" for="csvSeparatorComma">Comma</label>\n            <br>\n            <input type="radio" id="csvSeparatorSemi" name="csvSeparator" value=";">\n                <label id="DatalblcsvSeparatorSemi" class="filter-enabled-label" for="csvSeparatorSemi">Semicolon</label>\n        </li>\n    </ul>\n</div>'},useData:!0})},function(e,t,n){var i,a;i=[n(3),n(6),n(2),n(7),n(39),n(57),n(11)],a=function(e,t,n,i,a,o,r){"use strict";var s={btnMeta:"#btnMeta",btnDSD:"#btnDSD",btnData:"#btnData"},d=t.View.extend({render:function(t){e.extend(!0,this,{initial:t}),this._parseInput();var i=this._validateInput();return i===!0?(n.info("Rendering View - Home",this),this.$container.html(o),this._bindEventListeners(),this):(n.error("Impossible to render Home"),void n.error(i))},_validateInput:function(){var e=!0,t=[];return 0===this.$container.length&&(t.push({code:r.MISSING_CONTAINER}),n.warn("Impossible to find container")),t.length>0?t:e},_parseInput:function(){this.$container=e(this.initial.container),this.cache=this.initial.cache,this.environment=this.initial.environment,this.lang=this.initial.lang.toLowerCase()},_bindEventListeners:function(){e(this.$container.find(s.btnMeta)).on("click",function(){t.trigger("button:metadata")}),e(this.$container.find(s.btnDSD)).on("click",function(){t.trigger("button:dsd")}),e(this.$container.find(s.btnData)).on("click",function(){t.trigger("button:data")})},_removeEventListener:function(){e(this.$container.find(s.btnMeta)).off("click"),e(this.$container.find(s.btnDSD)).off("click"),e(this.$container.find(s.btnData)).off("click")},accessControl:function(t){return new i.Promise(function(n,i){e.isEmptyObject(t)?i():n()})},remove:function(){this._removeEventListener(),t.View.prototype.remove.apply(this,arguments)}});return d}.apply(t,i),!(void 0!==a&&(e.exports=a))},function(e,t,n){var i=n(13);e.exports=(i.default||i).template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div class="row">\n    <div class="col-xs-12">\n        <div class="datamng-welcome">\n            <h3 id="DManResHeader">Edit Resource</h3>\n\n            <div id="btnMeta" data-section="metadata" class="datamng-welcome-btn">\n                <a>\n                    <span id="txtMeta">Metadata</span>\n                </a>\n            </div>\n\n            <div id="btnDSD" data-section="dsd" class="datamng-welcome-btn">\n                <a>\n                    <span id="txtDSD">DSD</span>\n                </a>\n            </div>\n\n            <div id="btnData" data-section="data" class="datamng-welcome-btn">\n                <a>\n                    <span id="txtData">Data</span>\n                </a>\n            </div>\n\n        </div>\n\n    </div>\n</div>'},useData:!0})},function(e,t,n){var i=n(13);e.exports=(i.default||i).template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div id="fx-data-management" class="data-mng-container">\n    <div id="fx-data-management-menu"></div>\n    <div class="row">\n        <div class="col-md-12">\n            <h3>\n                <span id="fx-data-managment-header-title"></span>\n                <span id="fx-data-managment-resource-title"></span>\n            </h3>\n\n        </div>\n    </div>\n\n    <div id="fx-data-managment-update-model-holder" >\n\n        <div class="fx-datamng-utility-buttons">\n            <button id="fx-data-managment-update-button" class="btn btn-default pull-right"></button>\n            <div id="fx-data-management-utility-holder" class="pull-left"></div>\n        </div>\n    </div>\n\n    <div id="fx-data-management-content-holder"></div>\n\n</div>'},useData:!0})},function(e,t,n){var i;i=function(){"use strict";return{}}.call(t,n,t,e),!(void 0!==i&&(e.exports=i))},function(e,t){}])});
//# sourceMappingURL=fenix-ui-data-management.min.js.map